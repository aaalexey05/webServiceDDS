# Веб‑сервис ДДС (Django + DRF)

Простое веб‑приложение для учета движения денежных средств (ДДС): CRUD записей, фильтры, справочники и логические зависимости (тип→категория, категория→подкатегория). В комплекте REST API и стартовая загрузка справочников.

## Требования
- Python 3.11+ (проверено на 3.13)
- pip, venv
- SQLite по умолчанию (настройки БД можно поменять в `dds_project/settings.py`)

## Установка и запуск
1) Клонирование и окружение
```
git clone <repo_url> webServiceDDS
cd webServiceDDS
python3 -m venv .venv
source .venv/bin/activate
pip install --upgrade pip setuptools wheel
pip install -r requirements.txt
```

2) Миграции
```
python manage.py migrate
```

3) Загрузка справочников (статусы, типы, категории, подкатегории)
```
python manage.py seed_dds
```

4) Создание администратора (вариант А — интерактивно)
```
python manage.py createsuperuser
```
Вариант Б — уже есть пользователь `admin` (пароль можно заменить командой ниже):
```
python manage.py changepassword admin
```

5) Запуск dev‑сервера
```
python manage.py runserver 0.0.0.0:8000
```
Открыть:
- Главная: http://127.0.0.1:8000/
- Админка: http://127.0.0.1:8000/admin/

Если увидели ошибку DisallowedHost при открытии по `0.0.0.0`, убедитесь, что в `ALLOWED_HOSTS` прописано `"0.0.0.0"` (это уже настроено в проекте).

## Функциональность
- CRUD записей ДДС: дата, статус, тип, категория, подкатегория, сумма, комментарий
- Фильтры списка: период дат, статус, тип, категория, подкатегория
- Справочники управляются через админку (добавление/редактирование/удаление)
- Проверка связей на сервере и клиенте:
  - Категория должна соответствовать типу
  - Подкатегория должна соответствовать категории
- Веб‑интерфейс: таблица с пагинацией, бейджи, формат рублей, карточка фильтров
- REST API (DRF)

## REST API
База: `http://127.0.0.1:8000/api/`
- `GET /records/` — список (фильтры: `created_at__gte`, `created_at__lte`, `status`, `cf_type`, `category`, `subcategory`)
- `POST /records/` — создать
- `GET /records/{id}/`, `PUT/PATCH`, `DELETE`
- Справочники: `/statuses/`, `/types/`, `/categories/?cf_type=ID`, `/subcategories/?category=ID`

Пример:
```
GET /api/records/?created_at__gte=2025-01-01&cf_type=2
```

## Настройка БД (опционально)
По умолчанию SQLite (`db.sqlite3`). Для PostgreSQL:
- Установить драйвер: `pip install psycopg2-binary`
- В `dds_project/settings.py` заменить `DATABASES['default']` на параметры подключения
- Применить миграции, загрузить справочники

## Архитектура
- Приложение: `dds`
  - `models.py` — сущности: статус, тип, категория, подкатегория, запись ДДС
  - `validators.py` — серверная валидация зависимостей
  - `serializers.py`, `views.py`, `urls.py` — DRF и веб‑вью
  - `forms.py` — форма записи (клиентская фильтрация списков)
  - `templates/dds/` — шаблоны (таблица, формы, модальное удаление)
  - `templatetags/currency.py` — фильтр форматирования рублей
  - `management/commands/seed_dds.py` — загрузка стартовых справочников

## Частые вопросы (FAQ)
- «Не сохраняется запись» — проверьте ошибки формы на странице: поля сумма/тип/категория/подкатегория обязательны; дата по умолчанию ставится на сегодня, можно поменять.
- «DisallowedHost на 0.0.0.0» — добавьте `0.0.0.0` в `ALLOWED_HOSTS` (есть по умолчанию).
- «Хочу другие категории/подкатегории» — добавьте их в админке или поправьте команду `seed_dds`.


## Деплой (опционально)
- Docker (минимальный план):
  - Создайте `Dockerfile` (python:3.13-slim), скопируйте проект, установите зависимости, запустите `collectstatic` (при необходимости) и `gunicorn`.
  - Создайте `docker-compose.yml` c Postgres, пробросьте переменные окружения (`DJANGO_SECRET_KEY`, `DATABASE_URL`).
  - Запустите: `docker compose up -d`, затем примените миграции и выполните `seed_dds`.
- Хостинг: Railway / Fly.io / Render / Heroku — добавьте переменные окружения и подключите БД.

## CI (опционально)
- GitHub Actions: запустите линтеры (flake8, isort, black) и тесты (`python manage.py test`) на каждый PR/commit в default-ветку.




